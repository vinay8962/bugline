generator client {
  provider = "prisma-client-js"
}

 datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password_hash String
  full_name     String
  global_role   String   @default("USER") // SUPER_ADMIN, USER
  created_at    DateTime @default(now())
  
  company_users CompanyUser[]
  assigned_bugs Bug[]     @relation("AssignedBugs")
  
  @@map("users")
}

model Company {
  id         String   @id @default(uuid())
  name       String
  slug       String   @unique
  created_at DateTime @default(now())
  
  company_users CompanyUser[]
  projects      Project[]
  
  @@map("companies")
}

model CompanyUser {
  id         String   @id @default(uuid())
  user_id    String
  company_id String
  role       String   // ADMIN, DEVELOPER, QA, OTHERS
  created_at DateTime @default(now())
  
  user    User    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  company Company @relation(fields: [company_id], references: [id], onDelete: Cascade)
  
  @@unique([user_id, company_id])
  @@map("company_users")
}

model Project {
  id         String   @id @default(uuid())
  company_id String
  name       String
  slug       String
  created_at DateTime @default(now())
  
  company Company @relation(fields: [company_id], references: [id], onDelete: Cascade)
  bugs    Bug[]
  
  @@unique([company_id, slug])
  @@map("projects")
}

model Bug {
  id             String   @id @default(uuid())
  project_id     String
  title          String
  description    String
  status         String   @default("open") // open, in_progress, resolved, closed
  priority       String   @default("medium") // low, medium, high, critical
  reporter_email String?
  assigned_to    String?
  created_at     DateTime @default(now())
  
  project  Project @relation(fields: [project_id], references: [id], onDelete: Cascade)
  assignee User?   @relation("AssignedBugs", fields: [assigned_to], references: [id])
  
  @@map("bugs")
}