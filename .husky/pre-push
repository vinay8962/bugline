#!/usr/bin/env sh

# Cross-platform monorepo architecture guard for pre-push
# Supports: Unix, macOS, Linux, Windows (via Git Bash)

echo "ğŸ” Running final monorepo architecture check before push..."

# Use cross-platform node execution
if command -v node >/dev/null 2>&1; then
  node scripts/monorepo-guard.js
else
  echo "âŒ ERROR: Node.js not found in PATH"
  echo "ğŸ’¡ Please ensure Node.js is installed and available"
  exit 1
fi

# Check exit code from guard script
exit_code=$?
if [ $exit_code -ne 0 ]; then
  echo ""
  echo "âŒ PUSH BLOCKED: Monorepo architecture violations detected!"
  echo "ğŸ“‹ Fix the violations above before pushing."
  echo "ğŸ”§ Run: npm run guard:fix"
  exit $exit_code
fi

echo "âœ… Final monorepo architecture check passed!" 