#!/usr/bin/env sh

# Cross-platform monorepo architecture guard for pre-commit
# Supports: Unix, macOS, Linux, Windows (via Git Bash)

echo "🔍 Checking monorepo architecture compliance..."

# Use cross-platform node execution
if command -v node >/dev/null 2>&1; then
  node scripts/monorepo-guard.js
else
  echo "❌ ERROR: Node.js not found in PATH"
  echo "💡 Please ensure Node.js is installed and available"
  exit 1
fi

# Check exit code from guard script
exit_code=$?
if [ $exit_code -ne 0 ]; then
  echo ""
  echo "❌ COMMIT BLOCKED: Monorepo architecture violations detected!"
  echo "📋 Fix the violations above before committing."
  echo "🔧 Run: npm run guard:fix"
  exit $exit_code
fi

echo "✅ Monorepo architecture check passed!"
